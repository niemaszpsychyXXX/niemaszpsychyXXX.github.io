// Display questions from Firebase
function displayQuestionsFromFirebase(questionsData) {
    const questionsList = document.getElementById('questionsList');
    
    if (!questionsData || Object.keys(questionsData).length === 0) {
        questionsList.innerHTML = '<p style="text-align: center; color: #666;">Brak pytań w bazie danych.</p>';
        return;
    }
    
    // Store current scroll position
    const scrollPosition = window.scrollY;
    
    // Create a document fragment to build the new content
    const fragment = document.createDocumentFragment();
    
    // Collect all questions with answers
    const allQuestions = [];
    
    Object.keys(questionsData).forEach(userId => {
        const userQuestions = questionsData[userId] || [];
        
        userQuestions.forEach(question => {
            // Skip questions without answers
            if (!question.answer) {
                return;
            }
            
            // Skip questions with secret answers
            if (question.answer.secret) {
                return;
            }
            
            // Skip questions with empty answer text
            if (!question.answer.text || question.answer.text.trim() === '') {
                return;
            }
            
            // Add the question with info about who asked and who answered
            allQuestions.push({
                ...question,
                askedTo: userId,
                askedToName: usersData[userId] || `Użytkownik (${userId.substring(0, 6)}...)`,
                askedByName: usersData[question.from] || `Użytkownik (${question.from.substring(0, 6)}...)`
            });
        });
    });
    
    // Check if there are any questions to display
    if (allQuestions.length === 0) {
        questionsList.innerHTML = '<p style="text-align: center; color: #666;">Brak odpowiedzianych pytań.</p>';
        return;
    }
    
    // Sort all questions by answer timestamp (newest first)
    allQuestions.sort((a, b) => {
        const timeA = a.answer.timestamp ? new Date(a.answer.timestamp.replace(/(\d{2}).(\d{2}).(\d{4})/, '$2/$1/$3')).getTime() : 0;
        const timeB = b.answer.timestamp ? new Date(b.answer.timestamp.replace(/(\d{2}).(\d{2}).(\d{4})/, '$2/$1/$3')).getTime() : 0;
        return timeB - timeA;
    });
    
    // Display all questions chronologically
    allQuestions.forEach(question => {
        const qaItem = document.createElement('div');
        qaItem.className = 'qa-item';
        
        qaItem.innerHTML = `
            <div class="question-section">
                <div class="question-header">
                    <span class="question-author">${question.askedByName}</span>
                    <span class="question-time">${question.timestamp || 'Brak daty'}</span>
                </div>
                <div class="question-content">${question.text || 'Brak treści pytania'}</div>
            </div>
            
            <div class="answer-section">
                <div class="answer-header">
                    <span class="answer-author">${question.askedToName}</span>
                    <span class="answer-time">${question.answer.timestamp || 'Brak daty'}</span>
                </div>
                <div class="answer-content">${question.answer.text}</div>
            </div>
        `;
        
        // Add new items to the top of the fragment
        if (questionsList.firstChild) {
            fragment.insertBefore(qaItem, questionsList.firstChild);
        } else {
            fragment.appendChild(qaItem);
        }
    });
    
    // Replace the content while preserving scroll position
    questionsList.innerHTML = '';
    questionsList.appendChild(fragment);
    
    // Restore scroll position
    window.scrollTo(0, scrollPosition);
}
