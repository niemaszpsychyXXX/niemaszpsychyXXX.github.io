<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pytania i Odpowiedzi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* [Previous CSS styles remain exactly the same] */
        
        /* Additional style for select dropdowns */
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- [Previous HTML remains the same until the filter section] -->
    
    <div class="sidebar" id="sidebar">
        <h2>Filtry</h2>
        
        <div class="filter-group">
            <label for="questionAuthor">Autor pytania:</label>
            <select id="questionAuthor">
                <option value="">Wszyscy autorzy</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>
        
        <div class="filter-group">
            <label for="answerAuthor">Autor odpowiedzi:</label>
            <select id="answerAuthor">
                <option value="">Wszyscy autorzy</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>
        
        <!-- [Rest of HTML remains the same] -->
    </div>

    <!-- [Rest of HTML remains the same] -->

    <script>
        // [Previous JavaScript remains the same until the processQuestionsFromFirebase function]

        function processQuestionsFromFirebase(questionsData) {
            allQuestions = [];
            
            if (!questionsData || Object.keys(questionsData).length === 0) {
                displayQuestions([]);
                return;
            }
            
            // Get unique user names
            const questionAuthors = new Set();
            const answerAuthors = new Set();
            
            Object.keys(questionsData).forEach(function(userId) {
                const userQuestions = questionsData[userId] || [];
                const answerAuthorName = usersData[userId] || `Użytkownik (${userId.substring(0, 6)}...)`;
                answerAuthors.add(answerAuthorName);
                
                userQuestions.forEach(function(question) {
                    if (!question.answer || question.answer.secret || !question.answer.text || question.answer.text.trim() === '') {
                        return;
                    }
                    
                    const questionAuthorName = usersData[question.from] || `Użytkownik (${question.from.substring(0, 6)}...)`;
                    questionAuthors.add(questionAuthorName);
                    
                    allQuestions.push({
                        ...question,
                        askedTo: userId,
                        askedToName: answerAuthorName,
                        askedByName: questionAuthorName
                    });
                });
            });
            
            // Populate dropdowns
            populateDropdown('questionAuthor', Array.from(questionAuthors).sort());
            populateDropdown('answerAuthor', Array.from(answerAuthors).sort());
            
            // Sort questions
            allQuestions.sort(function(a, b) {
                const timeA = a.answer.timestamp ? new Date(a.answer.timestamp.replace(/(\d{2}).(\d{2}).(\d{4})/, '$2/$1/$3')).getTime() : 0;
                const timeB = b.answer.timestamp ? new Date(b.answer.timestamp.replace(/(\d{2}).(\d{2}).(\d{4})/, '$2/$1/$3')).getTime() : 0;
                return timeB - timeA;
            });
            
            applyFilters();
        }
        
        function populateDropdown(id, options) {
            const dropdown = document.getElementById(id);
            dropdown.innerHTML = '<option value="">Wszyscy autorzy</option>';
            
            options.forEach(function(option) {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                dropdown.appendChild(opt);
            });
        }
        
        // [Rest of JavaScript remains the same]
    </script>
</body>
</html>
